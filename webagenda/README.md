## Generating the Schedule for the Website

This directory contains the data files and code used to generate the schedule (`_pages/output/schedule.md`) for the NAACL official website.
This code is ported from the NAACL 2019 schedule generation code written by Nitin Madnani.

### Requirements

Python 3.6+ with:

- [BeautifulSoup4](https://pypi.org/project/beautifulsoup4/)
- [lxml](https://pypi.org/project/lxml/)

### Generating the Schedule

1. Prepare the files needed for the `generate.py` script. Refer to [the 2019 README](https://github.com/naacl-org/naacl-schedule-2019/blob/master/README.md) for the format of these files.

    - Download the spreadsheets given by the Program Chairs. Save them to `webagenda/raw/`.

    - Edit `webagenda/raw/order-outline.txt` to contain the schedule outline.
        - In addition to the [`order` file syntax](https://github.com/naacl-org/naacl-schedule-2019/blob/master/README.md#parsing-the-order-file), JSONL filters can be used. The `preprocess_data.py` script below will replace them with matching papers from the downloaded schedules.
        - The `#` symbol for marking metadata has been changed to `##` to accommodate `#` in the title.

    - Process the downloaded files by running the following command at the top level of the cloned repository:
        ```
        python webagenda/preprocess_data.py
        ```
        This creates `webagenda/preprocessed/order.txt` and `webagenda/preprocessed/metadata.tsv`. The script also checks for duplicates and missing entries. If you are adding files to `webagenda/raw/`, you might need to change the hardcoded paths in the script and modify the data preprocessing logic.

2. Use the following command to generate the schedule markdown file at `_pages/program/schedule.md` for the website:
    ```
    python webagenda/generate.py webagenda/config.json _pages/output/schedule.md
    ```

### Script Details 

There are three main files that support the schedule on the website:

1. `generate.py` : This is the main driver script that generates the schedule markdown file for the repository. It takes as input a single JSON configuration file that contains the following fields:
    
    - `order_file` : The manually combined order file for the main conference.
    - `mapping_file` : File mapping the anthology IDs to the START / order file IDs for the main conference.
    - `xml_file` : The XML file from the Anthology containing the titles, authors, abstracts, and anthology URLs for the items in the main conference.
    - `extra_metadata_file` : An optional TSV file containing the title, authors, and abstracts for the main conference items that are not in the anthology (e.g., TACL papers, SRW non-archival workshop papers, etc.)
    - `plenary_info_file` : Another optional TSV file containing additional info about some of the plenary sessions (e.g., keynote abstracts etc.)
    - `pdf_icons` : A boolean indicating whether to generate icons in the schedule that link to anthology PDFs or PDFs specified in the extra metadata file.
    - `video_icons` : A boolean indicating whether to generate icons in the schedule that link to the talk videos hosted on Vimeo/YouTube or other video platforms.

    For more details on how this script works, please refer to the code and the comments in the script.

2. `frontmatter.md` : This markdown document contains the Jekyll frontmatter that needs to be appended on top of the HTML generated by `generate.py` to generate a valid markdown file that will be rendered properly by Jekyll. This file expected by `generate.py` to live in the same directory without being provided explicitly as input.

3. `assets/js/schedule.js` : This is the core JavaScript code that powers the official schedule page on the NAACL website. It allows a user to expand and collapse various sessions, shows them which papers conflict with each other as they hover on them, allows them to select the papers they are interested in, and, finally, generates a PDF with the user's customized schedule. The code uses the following JavaScript libraries:
    
    - [jQuery](https://jquery.com)
    - [jsPDF](https://parall.ax/products/jspdf) along with the amazingly useful [autotable plugin](https://github.com/simonbengtsson/jsPDF-AutoTable)
    - [Altertify](https://alertifyjs.com)
    - [fold-to-ascii](https://github.com/mplatt/fold-to-ascii)

    These libraries are installed in `assets/js/` and are minified into the main JS. If you want to update them, [follow the instructions here](https://mmistakes.github.io/minimal-mistakes/docs/javascript/#customizing).

